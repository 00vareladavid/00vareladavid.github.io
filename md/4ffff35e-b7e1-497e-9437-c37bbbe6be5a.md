# Setting up ssh inside of systemd-nspawn

## Motivation

Now that the big distros (debian, arch, and RHEL) have switched to systemd,
  I find that systemd-nspawn is the most painless way to run a container.
I do most of my work inside of containers;
  which means multiple interactive processes per container.
Some system is required to manage interaction with multiple processes.
In general, two choices are available:

- run a multiplexer (e.g. tmux) after an ssh connection is made
- connect to the container using multiple ssh connections; one connection per process

Both options have strengths and weaknesses.
Two weaknesses of terminal multiplexers:
  they consume key-bindings
  and they add complexity to the connection stream.
Even if you choose to run a multiplexer,
  I recommend setting up ssh for the added flexibility.

## Instructions

**Outside of the container**

- make sure the systemd-nspawn container is running: `systemd-nspawn <...>`

**Inside the container**

- install an ssh daemon: `pacman -S openssh`
    - of course if you are not running arch, replace `pacman` with `apt`, `yum`, ...
- configure ssh: a good starting point is this [guide](https://www.linode.com/docs/security/securing-your-server)
    - generate ssh keys locally
    - transfer keys to container
    - configure sshd
        - disable root login
        - disable password login
- enable the ssh daemon through systemd: `systemctl enable sshd`
    - do not forget to start the daemon!: `systemctl start sshd`

**Outside the container**

- login via ssh: `ssh <username>@localhost`

# TODO
- enable systemd-nspawn automatically
